<div style="margin-bottom: 15px">
    <MudNavMenu>
        <div class="d-flex flex-row">
            <MudButton Style="margin-right: 10px" Variant="Variant.Filled" Color="Color.Primary" @onclick="@(() => ShowCloseCreateDialog())">Create Fact</MudButton>
            <MudPopover Class="px-12 py-6" AnchorOrigin="Origin.BottomLeft" Open="@isCreateDialogOpen">
                @* <MudTextField Label="Name"></MudTextField> *@
                @* <MudTextField Label="Description"></MudTextField> *@
                <div style="display: flex; flex-direction: row">
                    <MudSelect T="string" Label="from" @bind-Value="A">
                        @* TODO: Replace with currently created node *@
                    </MudSelect>
                    <MudSelect T="string" Label="To" @bind-Value="A">

                    </MudSelect>
                </div>
            </MudPopover>
            <MudButton Style="margin-right: 10px" Variant="Variant.Filled" Color="Color.Primary" @onclick="@(() => ShowCloseConnectionDialog())">Create Connection</MudButton>
            <MudPopover Class="px-12 py-6" AnchorOrigin="Origin.BottomLeft" Open="@isCreateConnectionOpen">
                            @* <MudTextField Label="Name"></MudTextField> *@
                            @* <MudTextField Label="Description"></MudTextField> *@
                            <div style="display: flex; flex-direction: row">
                                <MudSelect T="string" Label="from" @bind-Value="A">
                                    @* TODO: Replace with currently created node *@
                                </MudSelect>
                                <MudSelect T="string" Label="To" @bind-Value="A">
            
                                </MudSelect>
                            </div>
                        </MudPopover>
            <MudButton Variant="Variant.Filled" Color="Color.Primary">Summary</MudButton>
        </div>
    </MudNavMenu>
</div>

<SfDiagramComponent @ref="diagram" Width="100%" Height="600px" NodeCreating="NodeCreating" ConnectorCreating="ConnectorCreating">
    <DataSourceSettings DataSource="RadialSource" ID="Id" ParentID="ReportingPerson"></DataSourceSettings>
    <Layout Type="LayoutType.RadialTree" HorizontalSpacing="30" VerticalSpacing="30"></Layout>
    <SnapSettings Constraints="@SnapConstraints.None"></SnapSettings>
</SfDiagramComponent>

<MudPopover Open="@isCreateConnectionOpen">

</MudPopover>

@code
{
    SfDiagramComponent diagram;
    string root = "node1";
    bool isCreateDialogOpen = false;
    bool isCreateConnectionOpen = false;

    public string A { get; set; }

    //Creates nodes with some default values.
    private void OnNodeCreating(IDiagramObject obj)
    {
        Node node = obj as Node;
        RadialTreeDetails radialData = node.Data as RadialTreeDetails;
        double size = 0;
        string color;
        if (radialData.Id == "parent")
        {
            size = 20;
            color = "white";
        }
        else
        {
            size = 10;
            color = "black";
        }

        ShapeAnnotation annotation = new ShapeAnnotation() { Content = radialData.Name, Style = new TextStyle() { Color = color, FontSize = size } };
        node.Annotations = new DiagramObjectCollection<ShapeAnnotation>() { annotation };

        if (radialData.Designation == "Managing Director")
        {
            node.Shape = new BasicShape()
            {
                Type = NodeShapes.Basic,
                Shape = NodeBasicShapes.Ellipse,
                CornerRadius = 10
            };
            node.Width = 150;
            node.Height = 150;
            node.Style.Fill = "black";
        }
        else if (radialData.Designation == "Project Manager")
        {
            node.Width = 65;
            node.Height = 65;
            node.Style.Fill = "#f8ab52";
        }
        else
        {
            node.Shape = new BasicShape()
            {
                Type = NodeShapes.Basic,
                Shape = NodeBasicShapes.Ellipse,
                CornerRadius = 10
            };
            node.Style.Fill = "#afeeee";
            node.Width = 50;
            node.Height = 50;
        }
    }

    //Creates connectors with some default values.
    private void OnConnectorCreating(IDiagramObject connector)
    {
        (connector as Connector).Type = ConnectorSegmentType.Straight;
    }

    public class RadialTreeDetails
    {
        public string Id { get; set; }
        public string Name { get; set; }
        public string Designation { get; set; }
        public string ReportingPerson { get; set; }
    }

    public List<RadialTreeDetails> RadialSource = new List<RadialTreeDetails>()
    {
        new RadialTreeDetails()
        {
            Id = "parent",
            Name = "Maria Anders",
            Designation = "Managing Director"
        },
        new RadialTreeDetails()
        {
            Id = "1",
            Name = "Ana Trujillo",
            Designation = "Project Manager",
            ReportingPerson = "parent"
        },
        new RadialTreeDetails()
        {
            Id = "2",
            Name = "Lino Rodri",
            Designation = "Project Manager",
            ReportingPerson = "parent"
        },
        new RadialTreeDetails()
        {
            Id = "3",
            Name = "Philip Cramer",
            Designation = "Project Manager",
            ReportingPerson = "parent"
        },
        new RadialTreeDetails()
        {
            Id = "4",
            Name = "Pedro Afonso",
            Designation = "Project Manager",
            ReportingPerson = "parent"
        },
        new RadialTreeDetails()
        {
            Id = "5",
            Name = "Anto Moreno",
            Designation = "Project Lead",
            ReportingPerson = "1"
        },
        new RadialTreeDetails()
        {
            Id = "6",
            Name = "Elizabeth Roel",
            Designation = "Project Lead",
            ReportingPerson = "1"
        },
        new RadialTreeDetails()
        {
            Id = "7", Name = "Aria Cruz", Designation = "Project Lead",
            ReportingPerson = "1"
        },
        new RadialTreeDetails()
        {
            Id = "8", Name = "Eduardo Roel", Designation = "Project Lead",
            ReportingPerson = "1"
        },
        new RadialTreeDetails()
        {
            Id = "9", Name = "Howard Snyd", Designation = "Project Lead",
            ReportingPerson = "2"
        },
        new RadialTreeDetails()
        {
            Id = "10", Name = "Daniel Tonini", Designation = "Project Lead",
            ReportingPerson = "2"
        },
        new RadialTreeDetails()
        {
            Id = "11", Name = "Nardo Batista", Designation = "Project Lead",
            ReportingPerson = "89"
        },
        new RadialTreeDetails()
        {
            Id = "12", Name = "Michael Holz", Designation = "Project Lead",
            ReportingPerson = "89"
        },
        new RadialTreeDetails()
        {
            Id = "13", Name = "Kloss Perrier", Designation = "Project Lead",
            ReportingPerson = "90"
        },
        new RadialTreeDetails()
        {
            Id = "14", Name = "Liz Nixon", Designation = "Project Lead",
            ReportingPerson = "3"
        },
        new RadialTreeDetails()
        {
            Id = "15", Name = "Paul Henriot", Designation = "Project Lead",
            ReportingPerson = "3"
        },
        new RadialTreeDetails()
        {
            Id = "16", Name = "Paula Parente", Designation = "Project Lead",
            ReportingPerson = "90"
        },
        new RadialTreeDetails()
        {
            Id = "17", Name = "Matti Kenna", Designation = "Project Lead",
            ReportingPerson = "4"
        },
        new RadialTreeDetails()
        {
            Id = "18", Name = "Laura Callahan", Designation = "Project Lead",
            ReportingPerson = "4"
        },
        new RadialTreeDetails()
        {
            Id = "19", Name = "Simon Roel", Designation = "Project Lead",
            ReportingPerson = "4"
        },
        new RadialTreeDetails()
        {
            Id = "20", Name = "Thomas Hardy", Designation = "Senior S/w Engg",
            ReportingPerson = "12"
        },
        new RadialTreeDetails()
        {
            Id = "21", Name = "Martín Kloss", Designation = "Senior S/w Engg",
            ReportingPerson = "5",
        },
        new RadialTreeDetails()
        {
            Id = "23", Name = "Diego Roel", Designation = "Senior S/w Engg",
            ReportingPerson = "7"
        },
        new RadialTreeDetails()
        {
            Id = "24", Name = "José Pedro", Designation = "Senior S/w Engg",
            ReportingPerson = "8"
        },
        new RadialTreeDetails()
        {
            Id = "25", Name = "Manu Pereira", Designation = "Senior S/w Engg",
            ReportingPerson = "8"
        },
        new RadialTreeDetails()
        {
            Id = "26", Name = "Annette Roel", Designation = "Senior S/w Engg",
            ReportingPerson = "25"
        },
        new RadialTreeDetails()
        {
            Id = "27", Name = "Catherine Kaff", Designation = "Senior S/w Engg",
            ReportingPerson = "8"
        },
        new RadialTreeDetails()
        {
            Id = "28", Name = "Lúcia Carvalho", Designation = "Senior S/w Engg",
            ReportingPerson = "12"
        },
        new RadialTreeDetails()
        {
            Id = "29", Name = "Alej Camino", Designation = "Senior S/w Engg",
            ReportingPerson = "13"
        },
        new RadialTreeDetails()
        {
            Id = "30", Name = "Liu Wong", Designation = "Senior S/w Engg",
            ReportingPerson = "14"
        },
        new RadialTreeDetails()
        {
            Id = "31", Name = "Karin Josephs", Designation = "Senior S/w Engg",
            ReportingPerson = "14"
        },
        new RadialTreeDetails()
        {
            Id = "33", Name = "Pirkko King", Designation = "Senior S/w Engg",
            ReportingPerson = "17"
        },
        new RadialTreeDetails()
        {
            Id = "34", Name = "Karl Jablonski", Designation = "Senior S/w Engg",
            ReportingPerson = "18"
        },
        new RadialTreeDetails()
        {
            Id = "35", Name = "Zbyszek Yang", Designation = "Senior S/w Engg",
            ReportingPerson = "19"
        },
        new RadialTreeDetails()
        {
            Id = "36", Name = "Nancy", Designation = "Senior S/w Engg",
            ReportingPerson = "5"
        },
        new RadialTreeDetails()
        {
            Id = "37", Name = "Anne", Designation = "Senior S/w Engg",
            ReportingPerson = "6"
        },
        new RadialTreeDetails()
        {
            Id = "38", Name = "Isabel Castro", Designation = "Senior S/w Engg",
            ReportingPerson = "7"
        },
        new RadialTreeDetails()
        {
            Id = "39", Name = "Nardo Batista", Designation = "Senior S/w Engg",
            ReportingPerson = "9"
        },
        new RadialTreeDetails()
        {
            Id = "40", Name = "Rene Phillips", Designation = "Senior S/w Engg",
            ReportingPerson = "16"
        },
        new RadialTreeDetails()
        {
            Id = "41", Name = "Rita Pfalzheim", Designation = "Senior S/w Engg",
            ReportingPerson = "9"
        },
        new RadialTreeDetails()
        {
            Id = "42", Name = "Janete Limeira", Designation = "Senior S/w Engg",
            ReportingPerson = "11"
        },
        new RadialTreeDetails()
        {
            Id = "43", Name = "Christina kaff", Designation = "S/w Engg",
            ReportingPerson = "20"
        },
        new RadialTreeDetails()
        {
            Id = "44", Name = "Peter Franken", Designation = "S/w Engg",
            ReportingPerson = "21"
        },
        new RadialTreeDetails()
        {
            Id = "45", Name = "Carlos Schmitt", Designation = "S/w Engg",
            ReportingPerson = "23"
        },
        new RadialTreeDetails()
        {
            Id = "46", Name = "Yoshi Wilson", Designation = "S/w Engg",
            ReportingPerson = "23"
        },
        new RadialTreeDetails()
        {
            Id = "47", Name = "Jean Fresnière", Designation = "S/w Engg",
            ReportingPerson = "24"
        },
        new RadialTreeDetails()
        {
            Id = "48", Name = "Simon Roel", Designation = "S/w Engg",
            ReportingPerson = "25"
        },
        new RadialTreeDetails()
        {
            Id = "52", Name = "Palle Ibsen", Designation = "S/w Engg",
            ReportingPerson = "29"
        },
        new RadialTreeDetails()
        {
            Id = "53", Name = "Lúcia Carvalho", Designation = "S/w Engg",
            ReportingPerson = "30"
        },
        new RadialTreeDetails()
        {
            Id = "54", Name = "Hanna Moos", Designation = "Project Trainee",
            ReportingPerson = "30"
        },
        new RadialTreeDetails()
        {
            Id = "55", Name = "Peter Citeaux", Designation = "Project Trainee",
            ReportingPerson = "33"
        },
        new RadialTreeDetails()
        {
            Id = "56", Name = "Elizabeth Mary", Designation = "Project Trainee",
            ReportingPerson = "33"
        },
        new RadialTreeDetails()
        {
            Id = "57", Name = "Victoria Ash", Designation = "Project Trainee",
            ReportingPerson = "34"
        },
        new RadialTreeDetails()
        {
            Id = "58", Name = "Janine Labrune", Designation = "Project Trainee",
            ReportingPerson = "35"
        },
        new RadialTreeDetails()
        {
            Id = "60", Name = "Carine Schmitt", Designation = "Project Trainee",
            ReportingPerson = "11"
        },
        new RadialTreeDetails()
        {
            Id = "61", Name = "Paolo Accorti", Designation = "Project Trainee",
            ReportingPerson = "38"
        },
        new RadialTreeDetails()
        {
            Id = "62", Name = "André Fonseca", Designation = "Project Trainee",
            ReportingPerson = "41"
        },
        new RadialTreeDetails()
        {
            Id = "63", Name = "Mario Pontes", Designation = "Project Trainee",
            ReportingPerson = "6"
        },
        new RadialTreeDetails()
        {
            Id = "64", Name = "John Steel", Designation = "Project Trainee",
            ReportingPerson = "7"
        },
        new RadialTreeDetails()
        {
            Id = "65", Name = "Renate Jose", Designation = "Project Trainee",
            ReportingPerson = "42"
        },
        new RadialTreeDetails()
        {
            Id = "66", Name = "Jaime Yorres", Designation = "Project Trainee",
            ReportingPerson = "20"
        },
        new RadialTreeDetails()
        {
            Id = "67", Name = "Alex Feuer", Designation = "Project Trainee",
            ReportingPerson = "21"
        },
        new RadialTreeDetails()
        {
            Id = "70", Name = "Helen Marie", Designation = "Project Trainee",
            ReportingPerson = "24"
        },
        new RadialTreeDetails()
        {
            Id = "73", Name = "Sergio roel", Designation = "Project Trainee",
            ReportingPerson = "37"
        },
        new RadialTreeDetails()
        {
            Id = "75", Name = "Janete Limeira", Designation = "Project Trainee",
            ReportingPerson = "29"
        },
        new RadialTreeDetails()
        {
            Id = "76", Name = "Jonas Bergsen", Designation = "Project Trainee",
            ReportingPerson = "18"
        },
        new RadialTreeDetails()
        {
            Id = "77", Name = "Miguel Ange", Designation = "Project Trainee",
            ReportingPerson = "18"
        },
        new RadialTreeDetails()
        {
            Id = "80", Name = "Helvetis Nagy", Designation = "Project Trainee",
            ReportingPerson = "34"
        },
        new RadialTreeDetails()
        {
            Id = "81", Name = "Rita Müller", Designation = "Project Trainee",
            ReportingPerson = "35"
        },
        new RadialTreeDetails()
        {
            Id = "82", Name = "Georg Pipps", Designation = "Project Trainee",
            ReportingPerson = "36"
        },
        new RadialTreeDetails()
        {
            Id = "83", Name = "Horst Kloss", Designation = "Project Trainee",
            ReportingPerson = "37"
        },
        new RadialTreeDetails()
        {
            Id = "84", Name = "Paula Wilson", Designation = "Project Trainee",
            ReportingPerson = "38"
        },
        new RadialTreeDetails()
        {
            Id = "85", Name = "Jose Michael", Designation = "Project Trainee",
            ReportingPerson = "37"
        },
        new RadialTreeDetails()
        {
            Id = "86", Name = "Mauri Moroni", Designation = "Project Trainee",
            ReportingPerson = "40"
        },
        new RadialTreeDetails()
        {
            Id = "87", Name = "Michael Holz", Designation = "Project Trainee",
            ReportingPerson = "41"
        },
        new RadialTreeDetails()
        {
            Id = "88", Name = "Alej Camino", Designation = "Project Trainee",
            ReportingPerson = "42"
        },
        new RadialTreeDetails()
        {
            Id = "89", Name = "Jytte Petersen", Designation = "Project Manager",
            ReportingPerson = "parent"
        },
        new RadialTreeDetails()
        {
            Id = "90", Name = "Mary Saveley", Designation = "Project Manager",
            ReportingPerson = "parent"
        },
        new RadialTreeDetails()
        {
            Id = "91", Name = "Robert King", Designation = "Project Manager",
            ReportingPerson = "parent"
        },
        new RadialTreeDetails()
        {
            Id = "95", Name = "Roland Mendel", Designation = "CSR",
            ReportingPerson = "19"
        },
        new RadialTreeDetails()
        {
            Id = "98", Name = "Helen Bennett", Designation = "SR",
            ReportingPerson = "42"
        },
        new RadialTreeDetails()
        {
            Id = "99", Name = "Carlos Nagy", Designation = "SR",
            ReportingPerson = "42"
        },
        new RadialTreeDetails()
        {
            Id = "100", Name = "Felipe Kloss", Designation = "SR",
            ReportingPerson = "77"
        },
    };

    private void NodeCreating(IDiagramObject obj)
    {
        Node node = obj as Node;
        node.Width = 60;
        node.Height = 60;
        ShapeAnnotation annotation = new ShapeAnnotation() { Content = node.ID, Style = new TextStyle() { Color = "black" } };
        node.Annotations = new DiagramObjectCollection<ShapeAnnotation>() { annotation };
    }

    private void ConnectorCreating(IDiagramObject connector)
    {
        (connector as Connector).Type = ConnectorSegmentType.Straight;
        (connector as Connector).TargetDecorator = new DecoratorSettings
        {
            Shape = DecoratorShape.None,
        };
    }

    private void ShowCloseCreateDialog()
    {
        isCreateDialogOpen = !isCreateDialogOpen;
    }

    private void ShowCloseConnectionDialog()
    {
        isCreateConnectionOpen = !isCreateConnectionOpen;
    }
}